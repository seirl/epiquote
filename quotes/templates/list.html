{% load comments vote %}

<table class="table-striped">
  {% for quote in quotes %}
    <tr>
      <td class="span12" style="{% if not quote.visible %}background-color:
          #F2DEDE{% endif %}">
        <blockquote>
          <p><small style="font-size: 0.9em;">
            <strong>{{ quote.author }}</strong>
            {% if quote.context %}(<em>{{ quote.context }}</em>){% endif %}
          </small></p>
          {{ quote.content|linebreaks }}
        </blockquote>
        <p style="margin-left: 20px;">
        <small>
          <a href="{% url 'show_quote' quote.id %}">#{{ quote.id }}</a> −
          Score : <span id="s{{ quote.id }}">{{ quote.score }}</span>
          (<span id="t{{ quote.id }}">{{ quote.num_votes }}</span>
          vote{{ quote.num_votes|pluralize }})
          {% if user.is_authenticated %}
            {% vote_for user quote as vote %}
            {% if not vote %}
              <span id="d{{ quote.id }}"> −
                <a href="javascript:void(0)"
                  onclick="vote('{{ quote.id }}', 'up');">(+)</a>
                <a href="javascript:void(0)"
                  onclick="vote('{{ quote.id }}', 'down');">(-)</a>
              </span>
            {% else %}
              {% if vote.vote == 1 %}
              <span id="d{{ quote.id }}"> −
                <a href="javascript:void(0)"
                  onclick="vote('{{ quote.id }}', 'clear', 1);"><b>(+)</b></a>
                <a href="javascript:void(0)"
                  onclick="vote('{{ quote.id }}', 'down', 1);">(-)</a>
              </span>
              {% else %}
                <span id="d{{ quote.id }}"> −
                 <a href="javascript:void(0)"
                   onclick="vote('{{ quote.id }}', 'up', -1);">(+)</a>
                 <a href="javascript:void(0)"
                   onclick="vote('{{ quote.id }}', 'clear', -1);"><b>(-)</b></a>
               </span>
              {% endif %}
            {% endif %}
          {% endif %}
          <span style="margin-right: 20px;" class="pull-right">
            <a href="javascript:void(0);" onclick="rimshot();">♫</a> −
            {% if user.is_authenticated %}
              {% if request.user in quote.fans.all %}
                <a onclick="fav('{{ quote.id }}');" id="f{{ quote.id }}"
                  href="javascript:void(0)">&lt;/3</a>
              {% else %}
                <a onclick="fav('{{ quote.id }}');" id="f{{ quote.id }}"
                    href="javascript:void(0)">&lt;3</a>
              {% endif %} −
            {% endif %}
            {% get_comment_count for quote as comment_count %}
            <a href="{% url 'show_quote' quote.id %}#c">{{ comment_count }}
                commentaire{{ comment_count|pluralize }}</a>
          </span>
        </small>
        </p>
      </td>
    </tr>
  {% endfor %}
</table>
